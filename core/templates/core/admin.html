{% extends "core/base.html" %}
{% load static %}

{% block title %}Admin | Three Generation Images{% endblock %}

{% block css %}
{{ block.super }}
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
/>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css"
/>
<link rel="stylesheet" href="{% static 'core/css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Welcome Admin!</h1>
    </div>

    <div class="upload-section">
      <div class="upload-buttons">
          <button id="doctor1Btn" class="btn btn-primary" onclick="switchForm(1)">Upload Doctor 1</button>
          <button id="doctor2Btn" class="btn btn-secondary" onclick="switchForm(2)">Upload Doctor 2</button>
      </div>
      <div class="upload-form">
          <h2 id="formHeader">Upload Doctor 1</h2>
          <form id="doctorForm" method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <input type="hidden" id="doctorId" name="doctorId" value="1">
              <div class="form-group">
                  <div>
                      <label for="territoryId">Territory ID</label>
                      <input type="text" id="territoryId" name="territoryId" class="form-control" placeholder="Enter Territory ID">
                  </div>
                  <div>
                      <label for="drRplId">Dr. RPL ID</label>
                      <input type="text" id="drRplId" name="drRplId" class="form-control" placeholder="Enter Dr. RPL ID">
                  </div>
              </div>
              <div class="form-group">
                  <div>
                      <label for="drName">Dr. Name</label>
                      <input type="text" id="drName" name="drName" class="form-control" placeholder="Enter Dr. Name">
                  </div>
                  <div>
                      <label for="drImage">Dr. Image</label>
                      <input type="file" id="drImage" name="drImage" accept="image/*">
                  </div>
              </div>
              <div class="form-group">
                  <div>
                      <label for="drParentImage">Dr. Parent Image</label>
                      <input type="file" id="drParentImage" name="drParentImage" accept="image/*">
                  </div>
                  <div>
                      <label for="drChildImage">Dr. Child Image</label>
                      <input type="file" id="drChildImage" name="drChildImage" accept="image/*">
                  </div>
              </div>
              <div class="form-group submit">
                  <button type="submit" class="btn btn-success">Upload</button>
              </div>
          </form>
      </div>
    </div>

    <div class="copy-message copy-hide" id="copyMessage">
      <h4>Copied to clipboard!</h4>
    </div>

    <div class="uploaded-data">
        <div class="my-container table-container">
            <div class="table-actions">
              <div class="left-actions">
                <a href="{% url 'download_all' %}" class="btn btn-sm btn-primary"><i class="fas fa-download"></i> Download</a>
                <button class="btn btn-sm btn-secondary copy-table-data" id="copyTableData" onclick="copyTableData('doctorTable')">
                  <i class="fas fa-copy"></i> Copy
                </button>
                <a href="{% url 'export_excel' %}" class="btn btn-sm btn-success"><i class="fas fa-file-excel"></i> Excel</a>
                <div class="dropdown">
                  <button
                    class="btn btn-sm btn-info dropdown-toggle"
                    type="button"
                    id="columnToggle"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <i class="fas fa-eye-slash"></i> Show/Hide Column
                  </button>
                  <ul class="dropdown-menu" aria-labelledby="columnToggle">
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="0" /> #</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="1" /> Dr. ID</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="2" /> Dr.
                        Name</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="3" />
                        Territory</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="4" /> Territory
                        Name</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="5" /> Region</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="6" /> Zone</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="8" /> Dr.
                        Image</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="9" /> Dr.
                        Parent</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="10" /> Dr.
                        Child</label
                      >
                    </li>
                    <li>
                      <label class="dropdown-item"
                        ><input type="checkbox" checked data-column="11" />
                        Actions</label
                      >
                    </li>
                  </ul>
                </div>
              </div>
              <div class="right-actions">
                <form method="get" >
                  <input
                  type="text"
                  name="search"
                  class="form-control"
                  placeholder="Search..."
                  style="width: 200px"
                  value="{{ search_query }}"
                />
                </form>
                
              </div>
            </div>
            <table class="table table-bordered table-striped" id="doctorTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>
                    <a href="?sort=dr_id&direction={% if sort == 'dr_id' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Dr. ID
                      {% if sort == 'dr_id' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>
                    <a href="?sort=dr_name&direction={% if sort == 'dr_name' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Dr. Name
                      {% if sort == 'dr_name' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>
                    <a href="?sort=territory&direction={% if sort == 'territory' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Territory
                      {% if sort == 'territory' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>
                    <a href="?sort=territory_name&direction={% if sort == 'territory_name' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Territory Name
                      {% if sort == 'territory_name' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>
                    <a href="?sort=region&direction={% if sort == 'region' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Region
                      {% if sort == 'region' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>
                    <a href="?sort=zone&direction={% if sort == 'zone' and direction == 'asc' %}desc{% else %}asc{% endif %}">
                      Zone
                      {% if sort == 'zone' %}
                        <i class="fas fa-sort-{% if direction == 'asc' %}up{% else %}down{% endif %}"></i>
                      {% else %}
                        <i class="fas fa-sort"></i>
                      {% endif %}
                    </a>
                  </th>
                  <th>Dr. Image</th>
                  <th>Dr. Parent</th>
                  <th>Dr. Child</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for doctor in data %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{doctor.dr_rpl_id}}</td>
                  <td>{{ doctor.dr_name }}</td>
                  <td>{{doctor.territory.territory}}</td>
                  <td>{{doctor.territory.territory_name}}</td>
                  <td>{{doctor.territory.region_name}}</td>
                  <td>{{doctor.territory.zone_name}}</td>
                  <td>
                    <img src="{{doctor.dr_image.url}}" alt="Dr. Image" />
                  </td>
                  <td>
                    <img src="{{doctor.dr_parents_image.url}}" alt="Dr. Parent" />  
                  </td>
                  <td>
                    <img src="{{doctor.dr_children_image.url}}" alt="Dr. Child" />
                  </td>
                  <td class="action-icons">
                    <a href="{% url 'upload' doctor.instance_id %}?territory={{doctor.territory.territory}}"><i class="fas fa-edit text-primary"></i></a>
                    
                    <a href="{% url 'delete_doctor' doctor.instance_id %}?territory={{doctor.territory.territory}}"><i class="fas fa-trash text-danger"></i></a> 
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="pagination-container">
                <div class="entries-info">
                  <div class="rows-selector">
                    Show <form method="get">
                      <input type="hidden" name="search" value="{{ search_query }}">
                      <input type="hidden" name="page" value="1">
                      <input type="number" name="per_page" id="rowsPerPage" min="1" value="{{ per_page }}" onchange="this.form.submit()"> entries </form>
                  </div>
                    Showing {{ data.start_index }} to {{ data.end_index }} of {{ data.paginator.count }} entries
                </div>
              <nav aria-label="Page navigation">
  <ul class="pagination">
    {% if data.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ data.previous_page_number }}&per_page={{ per_page }}&search={{ search_query }}">« Previous</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">« Previous</span></li>
    {% endif %}

    {% for num in data.paginator.page_range %}
      {% if data.number == num %}
        <li class="page-item active">
          <span class="page-link">{{ num }}</span>
        </li>
      {% elif num > data.number|add:'-3' and num < data.number|add:'3' %}
        <li class="page-item">
          <a class="page-link" href="?page={{ num }}&per_page={{ per_page }}&search={{ search_query }}">{{ num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if data.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ data.next_page_number }}&per_page={{ per_page }}&search={{ search_query }}">Next »</a>
      </li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Next »</span></li>
    {% endif %}
  </ul>
</nav>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'core/js/admin.js' %}"></script>
{% endblock %}